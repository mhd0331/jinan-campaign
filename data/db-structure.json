{
  "collections": {
    "campaigns": {
      "description": "캠페인 기본 정보",
      "document_id": "jinan-wooden-tower",
      "fields": {
        "title": {
          "type": "string",
          "required": true,
          "example": "진안 목조전망대 반대"
        },
        "description": {
          "type": "string",
          "required": true,
          "example": "445억원 혈세낭비 반대 캠페인"
        },
        "targetSignatures": {
          "type": "number",
          "required": true,
          "default": 10000
        },
        "currentSignatures": {
          "type": "number",
          "required": true,
          "default": 0,
          "description": "실시간 업데이트됨"
        },
        "startDate": {
          "type": "timestamp",
          "required": true
        },
        "endDate": {
          "type": "timestamp",
          "required": true
        },
        "voteDate": {
          "type": "timestamp",
          "required": true,
          "description": "의회 표결일"
        },
        "status": {
          "type": "string",
          "required": true,
          "enum": ["active", "paused", "completed", "cancelled"],
          "default": "active"
        },
        "stats": {
          "type": "object",
          "fields": {
            "totalViews": "number",
            "totalShares": "number",
            "dailySignatures": "number[]"
          }
        },
        "createdAt": {
          "type": "timestamp",
          "required": true
        },
        "updatedAt": {
          "type": "timestamp",
          "required": true
        }
      }
    },
    "signatures": {
      "description": "서명 데이터",
      "fields": {
        "campaignId": {
          "type": "string",
          "required": true,
          "example": "jinan-wooden-tower"
        },
        "name": {
          "type": "string",
          "required": true,
          "validation": "2자 이상"
        },
        "region": {
          "type": "string",
          "required": true,
          "enum": ["진안읍", "마령면", "백운면", "성수면", "동향면", "용담면", "정천면", "주천면", "안천면", "부귀면", "상전면"]
        },
        "phone": {
          "type": "string",
          "required": false,
          "validation": "010-XXXX-XXXX 형식"
        },
        "email": {
          "type": "string",
          "required": false,
          "validation": "이메일 형식"
        },
        "comment": {
          "type": "string",
          "required": false,
          "maxLength": 500
        },
        "isPublic": {
          "type": "boolean",
          "required": true,
          "default": false,
          "description": "이름 공개 동의"
        },
        "allowContact": {
          "type": "boolean",
          "required": true,
          "default": false
        },
        "agreePrivacy": {
          "type": "boolean",
          "required": true,
          "validation": "must be true"
        },
        "ipHash": {
          "type": "string",
          "required": true,
          "description": "중복 방지용 IP 해시"
        },
        "phoneHash": {
          "type": "string",
          "required": false,
          "description": "중복 방지용 전화번호 해시"
        },
        "timestamp": {
          "type": "timestamp",
          "required": true
        },
        "verificationStatus": {
          "type": "string",
          "enum": ["pending", "verified", "rejected"],
          "default": "pending"
        }
      },
      "indexes": [
        {
          "fields": ["campaignId", "timestamp"],
          "order": ["asc", "desc"]
        },
        {
          "fields": ["campaignId", "region", "timestamp"],
          "order": ["asc", "asc", "desc"]
        }
      ]
    },
    "users": {
      "description": "사용자 프로필",
      "fields": {
        "uid": {
          "type": "string",
          "required": true
        },
        "displayName": {
          "type": "string",
          "required": false
        },
        "email": {
          "type": "string",
          "required": false
        },
        "photoURL": {
          "type": "string",
          "required": false
        },
        "region": {
          "type": "string",
          "required": false
        },
        "level": {
          "type": "number",
          "default": 1
        },
        "points": {
          "type": "number",
          "default": 0
        },
        "totalPosts": {
          "type": "number",
          "default": 0
        },
        "totalComments": {
          "type": "number",
          "default": 0
        },
        "badges": {
          "type": "array",
          "items": {
            "id": "string",
            "name": "string",
            "earnedAt": "timestamp"
          }
        },
        "preferences": {
          "type": "object",
          "fields": {
            "notifications": {
              "mentions": "boolean",
              "comments": "boolean",
              "news": "boolean"
            },
            "privacy": {
              "showEmail": "boolean",
              "showPhone": "boolean"
            }
          }
        },
        "isActive": {
          "type": "boolean",
          "default": true
        },
        "isAdmin": {
          "type": "boolean",
          "default": false
        },
        "isModerator": {
          "type": "boolean",
          "default": false
        },
        "createdAt": {
          "type": "timestamp",
          "required": true
        },
        "lastActive": {
          "type": "timestamp",
          "required": true
        }
      }
    },
    "posts": {
      "description": "게시글",
      "fields": {
        "title": {
          "type": "string",
          "required": true,
          "maxLength": 100
        },
        "content": {
          "type": "string",
          "required": true,
          "maxLength": 5000
        },
        "authorId": {
          "type": "string",
          "required": true
        },
        "authorName": {
          "type": "string",
          "required": true
        },
        "authorRegion": {
          "type": "string",
          "required": false
        },
        "category": {
          "type": "string",
          "required": true,
          "enum": ["공지사항", "자유토론", "긴급제보", "아이디어", "활동인증", "Q&A", "의회소식"]
        },
        "hashtags": {
          "type": "array",
          "items": "string",
          "maxItems": 5
        },
        "images": {
          "type": "array",
          "items": {
            "url": "string",
            "caption": "string"
          },
          "maxItems": 5
        },
        "reactions": {
          "type": "object",
          "fields": {
            "like": "number",
            "love": "number",
            "angry": "number",
            "sad": "number"
          },
          "default": {
            "like": 0,
            "love": 0,
            "angry": 0,
            "sad": 0
          }
        },
        "viewCount": {
          "type": "number",
          "default": 0
        },
        "commentCount": {
          "type": "number",
          "default": 0
        },
        "isPinned": {
          "type": "boolean",
          "default": false
        },
        "isActive": {
          "type": "boolean",
          "default": true
        },
        "createdAt": {
          "type": "timestamp",
          "required": true
        },
        "updatedAt": {
          "type": "timestamp",
          "required": true
        }
      },
      "indexes": [
        {
          "fields": ["category", "isPinned", "createdAt"],
          "order": ["asc", "desc", "desc"]
        },
        {
          "fields": ["isActive", "createdAt"],
          "order": ["asc", "desc"]
        }
      ]
    },
    "comments": {
      "description": "댓글",
      "fields": {
        "postId": {
          "type": "string",
          "required": true
        },
        "parentCommentId": {
          "type": "string",
          "required": false,
          "description": "대댓글인 경우"
        },
        "authorId": {
          "type": "string",
          "required": true
        },
        "authorName": {
          "type": "string",
          "required": true
        },
        "content": {
          "type": "string",
          "required": true,
          "maxLength": 1000
        },
        "reactions": {
          "type": "object",
          "fields": {
            "like": "number"
          },
          "default": {
            "like": 0
          }
        },
        "isActive": {
          "type": "boolean",
          "default": true
        },
        "createdAt": {
          "type": "timestamp",
          "required": true
        }
      },
      "indexes": [
        {
          "fields": ["postId", "createdAt"],
          "order": ["asc", "asc"]
        }
      ]
    },
    "polls": {
      "description": "투표",
      "fields": {
        "title": {
          "type": "string",
          "required": true
        },
        "description": {
          "type": "string",
          "required": true
        },
        "type": {
          "type": "string",
          "enum": ["single", "multiple", "discussion"],
          "required": true
        },
        "options": {
          "type": "array",
          "items": {
            "id": "number",
            "text": "string",
            "description": "string",
            "votes": "number",
            "percentage": "number"
          },
          "required": true
        },
        "totalVotes": {
          "type": "number",
          "default": 0
        },
        "isActive": {
          "type": "boolean",
          "default": true
        },
        "expiresAt": {
          "type": "timestamp",
          "required": false
        },
        "createdAt": {
          "type": "timestamp",
          "required": true
        }
      }
    },
    "poll_votes": {
      "description": "투표 기록",
      "fields": {
        "pollId": {
          "type": "string",
          "required": true
        },
        "userId": {
          "type": "string",
          "required": true
        },
        "selectedOptions": {
          "type": "array",
          "items": "number",
          "required": true
        },
        "timestamp": {
          "type": "timestamp",
          "required": true
        }
      },
      "indexes": [
        {
          "fields": ["pollId", "userId"],
          "order": ["asc", "asc"]
        }
      ]
    },
    "notifications": {
      "description": "알림",
      "fields": {
        "userId": {
          "type": "string",
          "required": true
        },
        "type": {
          "type": "string",
          "enum": ["mention", "comment", "like", "news", "system"],
          "required": true
        },
        "title": {
          "type": "string",
          "required": true
        },
        "message": {
          "type": "string",
          "required": true
        },
        "relatedId": {
          "type": "string",
          "required": false
        },
        "isRead": {
          "type": "boolean",
          "default": false
        },
        "createdAt": {
          "type": "timestamp",
          "required": true
        }
      },
      "indexes": [
        {
          "fields": ["userId", "isRead", "createdAt"],
          "order": ["asc", "asc", "desc"]
        }
      ]
    },
    "statistics": {
      "description": "통계 데이터",
      "fields": {
        "date": {
          "type": "string",
          "required": true,
          "format": "YYYY-MM-DD"
        },
        "type": {
          "type": "string",
          "enum": ["daily", "weekly", "monthly"],
          "required": true
        },
        "signatures": {
          "type": "object",
          "fields": {
            "total": "number",
            "new": "number",
            "byRegion": "object"
          }
        },
        "users": {
          "type": "object",
          "fields": {
            "activeUsers": "number",
            "newUsers": "number"
          }
        },
        "posts": {
          "type": "object",
          "fields": {
            "total": "number",
            "new": "number",
            "byCategory": "object"
          }
        }
      }
    }
  },
  "security_rules": {
    "campaigns": {
      "read": "allow if true",
      "write": "allow if isAdmin()"
    },
    "signatures": {
      "create": "allow if isValidSignature()",
      "read": "allow if isAdmin() || (resource.data.isPublic && !hasPersonalInfo())",
      "update": "allow if false",
      "delete": "allow if false"
    },
    "users": {
      "read": "allow if true",
      "write": "allow if request.auth.uid == userId || isAdmin()"
    },
    "posts": {
      "read": "allow if resource.data.isActive",
      "create": "allow if request.auth != null",
      "update": "allow if request.auth.uid == resource.data.authorId || isModerator()",
      "delete": "allow if request.auth.uid == resource.data.authorId || isAdmin()"
    }
  }
}